import Head from 'next/head';
import { useRecoilValue } from 'recoil';
import { modalState } from '../atoms/modalAtom';
import Banner from '../components/Banner';
import Header from '../components/Header';
import Modal from '../components/Modal';
import Row from '../components/Row';
import useAuth from '../hooks/useAuth';
import { Movie } from '../typing';
import requests from '../utils/requests';

type Props = {
	trendingNow: Movie[],
};

export const getServerSideProps = async () => {
	try {
		const [trendingNow] = await Promise.all([
			fetch(requests.fetchTrending).then((results) => results.json()),
		]);
		return {
			props: {
				trendingNow: trendingNow.results,
			},
		};

	} catch (error) {
		console.trace(error);
	}
};

const Home = ({
	trendingNow,
}: Props) => {
	
	const { loading } = useAuth();
	const showModal = useRecoilValue(modalState);
	if (loading) return null;
	
	

	return (
		<div className='relative h-screen bg-gradient-to-b from-gray-900/10 to-[#010511] lg:h-[140vh]'>
			<Head>
				<title>Tonyflix - Accueil</title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>
			<Header />
			<main className='relative pl-4 pb-24 lg:space-y-24 lg:pl-16'>
				<Banner bannerData={trendingNow} />
				<section className='md:space-y-24'>
					<Row title='Tendances actuelles' movies={trendingNow}/>
				</section>
			</main>
			{showModal && <Modal />}
		</div>
	);
};

export default Home;
